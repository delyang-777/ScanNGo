{% extends 'base.html' %}

{% block content %}
<div style="height: 100vh; display: flex; flex-direction: column; background: #0f0f1f; overflow: hidden;">

    <!-- Fixed Header -->
    <div style="
        position: fixed; top: 0; left: 0; right: 0;
        display: flex; align-items: center; gap: 10px;
        padding: 15px; background: rgba(15,15,31,0.95);
        box-shadow: 0 2px 10px rgba(0,255,255,0.3); z-index: 999;
    ">
        <a href="{{ url_for('admin_dashboard') }}"
           style="display: inline-flex; align-items: center; justify-content: center;
                  padding: 8px 14px; background: linear-gradient(135deg, #00f6ff, #00fff6);
                  color: #0f0f1f; font-weight: bold; font-size: 1.1em; border-radius: 30px;
                  text-decoration: none;">
            &#8592;
        </a>

        <h2 style="color: #00f6ff; font-family: 'Orbitron', sans-serif; font-size: 2em; margin: 0;">
            Manage Members
        </h2>
    </div>

    <!-- Spacer for fixed header -->
    <div style="height: 90px; flex-shrink: 0;"></div>

    <!-- Scrollable Content Area -->
    <div style="flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 15px 20px 15px;">
        
        <!-- Action Buttons -->
        <div style="text-align: center; margin-bottom: 15px; display:flex; gap:10px; flex-wrap: wrap; justify-content:center; position: sticky; top: 0; background: #0f0f1f; padding: 10px 0; z-index: 10;">
            <button class="action-btn" id="add-member-btn">Add Member</button>
        </div>

        <!-- Pending Profile Updates Section -->
        {% if pending_updates %}
        <div style="background: #1a1a2e; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 0 15px #ff9d0044;">
            <h3 style="color: #ff9d00; margin-bottom: 15px; font-family: 'Orbitron', sans-serif;">⏳ Pending Profile Updates ({{ pending_updates|length }})</h3>
            
            {% for update in pending_updates %}
            <div style="background: #0f0f1f; border-radius: 10px; padding: 15px; margin-bottom: 10px; border-left: 4px solid #ff9d00;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 10px;">
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">User ID:</strong> {{ update.user_id }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Username:</strong> {{ update.username }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Email:</strong> {{ update.email }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Full Name:</strong> {{ update.full_name or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Age:</strong> {{ update.age or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Year Level:</strong> {{ update.year_level or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Status:</strong> {{ update.status or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Citizenship:</strong> {{ update.citizenship or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Address:</strong> {{ update.address or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Place of Birth:</strong> {{ update.place_of_birth or 'N/A' }}</p>
                    <p style="color: #fff; margin: 5px 0;"><strong style="color: #00f6ff;">Submitted:</strong> {{ update.submitted_at.strftime('%Y-%m-%d %H:%M') }}</p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <form method="post" action="{{ url_for('approve_update', update_id=update.id) }}" style="flex: 1;">
                        <button type="submit" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #00ff85, #00d4ff);
                               color: #0f0f1f; font-weight: bold; border-radius: 8px; border: none; cursor: pointer;
                               box-shadow: 0 0 8px #00f6ff66; transition: all 0.3s;">
                            ✅ Approve
                        </button>
                    </form>
                    <form method="post" action="{{ url_for('reject_update', update_id=update.id) }}" style="flex: 1;">
                        <button type="submit" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #ff4c4c, #ff6b6b);
                               color: #fff; font-weight: bold; border-radius: 8px; border: none; cursor: pointer;
                               box-shadow: 0 0 8px #ff4c4c66; transition: all 0.3s;">
                            ❌ Reject
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Members Table -->
        <div style="overflow-x: auto;">
            <table style="width:100%; border-collapse: collapse; color: #fff; min-width: 900px;">
                <thead>
                    <tr style="background: #00f6ff; color: #0f0f1f; position: sticky; top: 0; z-index: 2;">
                        <th style="padding: 10px;">ID</th>
                        <th style="padding: 10px;">Name</th>
                        <th style="padding: 10px;">Email</th>
                        <th style="padding: 10px;">Role</th>
                        <th style="padding: 10px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr style="border-bottom: 1px solid #00f6ff33;">
                        <td style="padding: 10px;">{{ member.id }}</td>
                        <td style="padding: 10px;">{{ member.username }}</td>
                        <td style="padding: 10px;">{{ member.email }}</td>
                        <td style="padding: 10px;">{{ member.role }}</td>
                        <td style="padding: 10px; display:flex; gap:5px;">
                            <button class="action-btn view-btn" onclick="window.location.href='/admin/members/view/{{ member.id }}'">View</button>
                            <button class="action-btn edit-btn" onclick="window.location.href='/admin/members/edit/{{ member.id }}'">Edit</button>
                            <form method="GET" action="{{ url_for('remove_member', member_id=member.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this member?');">
                                <button type="submit" class="action-btn delete-btn">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align:center; color:#aaa; padding:20px;">
                            No members found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<style>
html, body {
    overflow-x: hidden;
    scroll-behavior: smooth;
}

body { 
    background-color: #0f0f1f; 
    font-family: 'Poppins', sans-serif; 
    margin: 0;
    padding: 0;
}

.action-btn {
    background-color: #1a1a2e;
    color: #fff;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}

.action-btn:hover { background-color: #2e2e4d; transform: translateY(-2px); }

.view-btn { background-color: #00b894; }
.view-btn:hover { background-color: #019874; }

.edit-btn { background-color: #007bff; }
.edit-btn:hover { background-color: #0056b3; }

.delete-btn { background-color: #dc3545; }
.delete-btn:hover { background-color: #a71d2a; }

/* Pending update button hover effects */
form button:hover {
    transform: scale(1.05);
    opacity: 0.9;
}

/* Smooth scrollbar styling */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: #0f0f1f;
}

::-webkit-scrollbar-thumb {
    background: #00f6ff66;
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: #00f6ff;
}

@media (max-width: 600px) { table { min-width: 750px; } }
</style>

<script>
document.getElementById('add-member-btn').addEventListener('click', function() {
    window.location.href = "{{ url_for('add_member') }}";
});
</script>
{% endblock %}
